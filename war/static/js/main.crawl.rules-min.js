function refreshCrawlRules(){crawlRules.fn.changeRulesVer(crawlRules.v.rulesVerId)}var crawlRules={v:{jsonData:null,siteJson:null,crawlRulesForm:"crawlRulesForm",tableId:"crawlRulesTable",rulesVerId:null,pageLabelIndex:0,commonLabelIndex:0},fn:{createXpathRules:function(c,b){showLoading($("#"+pageRules.v.formId));var a=$.toJSON(c);jsonrpc.crawlRulesService.createByXpath(function(d,e,f){if(e){removeLoading($("#"+pageRules.v.formId));b(nc.i18n("res.create.failure"));return}if(!d){showInfo(nc.i18n("res.create.failure"));removeLoading($("#"+pageRules.v.formId));b(nc.i18n("res.create.failure"));return}removeLoading($("#"+pageRules.v.formId));crawlRules.fn.queryVer();b("success.")},pageRules.v.webCrawlerId,pageRules.v.siteId,crawlRules.v.rulesVerId,a)},init:function(){crawlRules.fn.xpathTools();crawlRules.v.jsonData=null;crawlRules.v.rulesVerId=null;crawlRules.v.pageLabelIndex=0;crawlRules.v.commonLabelIndex=0;poshytip(".tooltip");$("#crawlRulesTable #accordion").accordion({heightStyle:"content",change:function(f,g){var e=g.newHeader.text();e=e.substring(0,1);if(e=="1"){var d=$("#pageLabelTabel #all")[0];if(d){d.checked=false;crawlRules.fn.selectAll(d,"pageLabelTabel","rules");$("#"+crawlRules.v.crawlRulesForm).find("#labelType").val(1)}}else{var d=$("#crawlLabelTabel #all")[0];if(d){d.checked=false;crawlRules.fn.selectAll(d,"crawlLabelTabel","rules");$("#"+crawlRules.v.crawlRulesForm).find("#labelType").val(2)}}}});fillSite(pageRules.v.formId,"nextLinkMatchRules",true);$("#"+pageRules.v.formId).find("select[id=nextLinkMatchRules]").find("option[value='"+pageRules.v.siteId+"']").remove();fillSite(crawlRules.v.crawlRulesForm,"nestedSiteId",true);$("#"+crawlRules.v.crawlRulesForm).find("select[id=nestedSiteId]").find("option[value='"+pageRules.v.siteId+"']").remove();fillCustomInter("4",crawlRules.v.crawlRulesForm,"filterInter",true);var a=function(){fillCustomPlugin("3",crawlRules.v.crawlRulesForm,"fileSavePluginId")};fillCustomPlugin("2",crawlRules.v.crawlRulesForm,"filterPlugin",true,null,a);$("#"+crawlRules.v.crawlRulesForm).find("#absoluteUrlRegex").val("(?:href|src)=[\"'](.*?)[\"']");$("#"+crawlRules.v.crawlRulesForm).find("#fileSavePluginRegex").val("<\\s*img[^<]+src=[\"'](.*?)[\"'][^<]*?>");var c=crawlRules.v.siteJson;for(var b in c){if(isNaN(b)){continue}if(c[b]["id"]==pageRules.v.siteId){$("#"+crawlRules.v.tableId).find("#crawlUrl").val(c[b]["url"]);if(c[b]["isLoop"]=="Y"&&c[b]["isMerge"]=="Y"){$("#"+crawlRules.v.tableId).find(".mergeRules").css("display","")}break}}crawlRules.fn.queryVer();$("#"+crawlRules.v.tableId).find("#rulesVersion").find("#sortable").sortable({handle:".ui-icon-arrow-4",update:function(d,e){crawlRules.fn.sortRulesVer(e.item)}}).disableSelection();$("#"+crawlRules.v.tableId).find("#crawlLabelTabel").find("#sortable").sortable({handle:".ui-icon-arrow-4",update:function(d,e){crawlRules.fn.sortRules("1",e.item)}});$("#"+crawlRules.v.tableId).find("#pageLabelTabel").find("#sortable").sortable({handle:".ui-icon-arrow-4",update:function(d,e){crawlRules.fn.sortRules("2",e.item)}});$("#"+crawlRules.v.tableId).find("#sort_table tbody").sortable({handle:".ui-icon-arrow-4"});$("#"+crawlRules.v.tableId).find("#sort_table").find(".simplehighlight").hover(function(){$(this).addClass("datahighlight")},function(){$(this).removeClass("datahighlight")})},queryVer:function(){$("#"+crawlRules.v.tableId).find("#rulesVersion li").remove();jsonrpc.crawlRulesVerService.query(function(result,exception,profile){if(exception){removeLoading($("#"+pageRules.v.formId));return}var rulesVerId=null;var data=eval(result);for(var i in data){if(isNaN(i)){continue}var id=data[i]["id"];var versionName=data[i]["name"];crawlRules.fn.addRulesVer(id,versionName);if(rulesVerId==null){rulesVerId=id}}$("#"+crawlRules.v.tableId).find("#rulesVersion li").hover(function(){$(this).addClass("datahighlight")},function(){$(this).removeClass("datahighlight")});crawlRules.fn.changeRulesVer(rulesVerId)},pageRules.v.webCrawlerId,pageRules.v.siteId)},query:function(rulesVerId){$("#crawlLabelTabel").find("#sortable").empty();$("#pageLabelTabel").find("#sortable").empty();jsonrpc.crawlRulesService.query(function(result,exception,profile){var data=result;data=eval(data);crawlRules.v.jsonData=data;crawlRules.v.pageLabelIndex=0;crawlRules.v.commonLabelIndex=0;$("#"+pageRules.v.formId).find("#nextLinkExpress").val("");$("#"+pageRules.v.formId).find("#nextPageMaxTimes").val("");$("#"+pageRules.v.formId).find("#nextLinkMatchRules").val("");for(var i in data){if(isNaN(i)){continue}var id=data[i]["id"];var name=data[i]["name"];var startString=data[i]["startString"];var endString=data[i]["endString"];var labelType=data[i]["labelType"];var isDataOrigin=data[i]["isDataOrigin"];var dataOrigin=data[i]["dataOrigin"];if(labelType=="2"){if(name=="SYS_VAR_NEXTLINKEXPRESS"){$("#"+pageRules.v.formId).find("#nextLinkExpress").val(data[i]["defaultValue"]);continue}else{if(name=="SYS_VAR_NEXTPAGEMAXTIMES"){$("#"+pageRules.v.formId).find("#nextPageMaxTimes").val(data[i]["defaultValue"]);continue}else{if(name=="SYS_VAR_NEXTLINKMATCHRULES"){$("#"+pageRules.v.formId).find("#nextLinkMatchRules").val(data[i]["defaultValue"]);continue}}}}if(isDataOrigin=="true"&&(dataOrigin=="#DATAORIGIN_LABEL"||dataOrigin=="#DATAORIGIN_HEADER")){var valueFromLabel=data[i]["valueFromLabel"]}crawlRules.fn.addRow(id,name,startString,endString,labelType,isDataOrigin,dataOrigin,valueFromLabel)}removeLoading($("#"+pageRules.v.formId))},pageRules.v.webCrawlerId,pageRules.v.siteId,rulesVerId)},create:function(){var r=$("#"+crawlRules.v.crawlRulesForm).find("#name").val();var Z=getCheckbox(crawlRules.v.crawlRulesForm,"isAbsolute");var N=$("#"+crawlRules.v.crawlRulesForm).find("#absoluteUrlRegex").val();var M=$("#"+crawlRules.v.crawlRulesForm).find("#absoluteUrlBase").val();var v=getCheckbox(crawlRules.v.crawlRulesForm,"isCantNull");var o=$("#"+crawlRules.v.crawlRulesForm).find("#labelType").val();var J=getCheckbox(crawlRules.v.crawlRulesForm,"isOffset");var z=getCheckbox(crawlRules.v.crawlRulesForm,"isRegex");var W=$("#"+crawlRules.v.crawlRulesForm).find("#mergeRules").val();var R=getCheckbox(crawlRules.v.crawlRulesForm,"isSingleMatch");var I=$("#"+crawlRules.v.crawlRulesForm).find("#textComposition").val();var ab=$("#"+crawlRules.v.crawlRulesForm).find("#regexFilter").val();var a=$("#"+crawlRules.v.crawlRulesForm).find("#javascriptFilter").val();var q=$("#"+crawlRules.v.crawlRulesForm).find("#textLen").val();var b=$("#"+crawlRules.v.crawlRulesForm).find("#functionExpression").val();var k=getCheckbox(crawlRules.v.crawlRulesForm,"isPublic");var aa=getCheckbox(crawlRules.v.crawlRulesForm,"isHtmlPreprocess");var P=getRadio(crawlRules.v.crawlRulesForm,"selectType");var x=getRadio(crawlRules.v.crawlRulesForm,"searchMode");var D=$("#"+crawlRules.v.crawlRulesForm).find("#startString").val();var F=$("#"+crawlRules.v.crawlRulesForm).find("#endString").val();var l=$("#"+crawlRules.v.crawlRulesForm).find("#searchRegex").val();var m=$("#"+crawlRules.v.crawlRulesForm).find("#selectExpress").val();var B=$("#"+crawlRules.v.crawlRulesForm).find("#labelCombination").val();var A=getCheckbox(crawlRules.v.crawlRulesForm,"isDownload");var G=$("#"+crawlRules.v.crawlRulesForm).find("#fileSavePluginId").val();var T=$("#"+crawlRules.v.crawlRulesForm).find("#fileSavePluginRegex").val();var e=$("#"+crawlRules.v.crawlRulesForm).find("#fileSaveSubDir").val();var h=$("#"+crawlRules.v.crawlRulesForm).find("#filterInter").val();var n=$("#"+crawlRules.v.crawlRulesForm).find("#filterPlugin").val();var L=getCheckbox(crawlRules.v.crawlRulesForm,"isTemp");var H=getCheckbox(crawlRules.v.crawlRulesForm,"isLoop");var d=getCheckbox(crawlRules.v.crawlRulesForm,"loopSplit");var y=getCheckbox(crawlRules.v.crawlRulesForm,"isStartPosition");var U=getCheckbox(crawlRules.v.crawlRulesForm,"isNested");var f=getCheckbox(crawlRules.v.crawlRulesForm,"isURL");var Y=$("#"+crawlRules.v.crawlRulesForm).find("#nestedSiteId").val();var w=getCheckbox(crawlRules.v.crawlRulesForm,"isConvertEncoding");var V=getCheckbox(crawlRules.v.crawlRulesForm,"isDataOrigin");var K=$("#"+crawlRules.v.crawlRulesForm).find("#dataOrigin").val();var j=$("#"+crawlRules.v.crawlRulesForm).find("#valueFromLabel").val();var u=crawlRules.fn.getSortIndex();var O=crawlRules.fn.getCheckBox2Json("excludeHtmlTags");var g=crawlRules.fn.getTextJson("mustContainTextDiv");var X=crawlRules.fn.getTextJson("cantContainTextDiv");var t=crawlRules.fn.getTextJson("excludeTextDiv");var c=crawlRules.fn.getTextJson("replaceTextDiv");var Q=getCheckbox(crawlRules.v.crawlRulesForm,"isRegexMustContainText");var E=getCheckbox(crawlRules.v.crawlRulesForm,"isRegexCantContainText");var i=getCheckbox(crawlRules.v.crawlRulesForm,"isRegexExcludeText");var S=getCheckbox(crawlRules.v.crawlRulesForm,"isRegexReplaceText");var p=getCheckbox(crawlRules.v.crawlRulesForm,"isDefaultValue");var s=$("#"+crawlRules.v.crawlRulesForm).find("#defaultValue").val();var C="";if(V!="true"){K="";j=""}else{if(K!="#DATAORIGIN_LABEL"&&K!="#DATAORIGIN_HEADER"){j=""}}if(w=="true"){C=crawlRules.fn.getCheckBox2Json("convertEncode")}if(A!="true"){G=null;T="";e=""}if(x=="regex"){D="";F="";m="";B=""}else{if(x=="string"){l="";m="";B=""}else{if(x=="xpath"||x=="csspath"){l="";D="";F="";B=""}else{if(x=="label"){l="";D="";F="";m=""}}}}if(p!="true"){s=""}showLoading($("#"+pageRules.v.formId));jsonrpc.crawlRulesService.create(function(ac,ad,ae){if(ad){removeLoading($("#"+pageRules.v.formId));return}var af=ac;if(isNaN(af)){showInfo(nc.i18n("res.create.failure"));removeLoading($("#"+pageRules.v.formId));return}crawlRules.fn.createJson(af);crawlRules.fn.show(af);if(crawlRules.v.rulesVerId==null||crawlRules.v.rulesVerId===""){crawlRules.fn.queryVer()}else{removeLoading($("#"+pageRules.v.formId))}},{javaClass:"com.soso.web.jsonrpc.bo.CrawlRulesBo",webCrawlerId:pageRules.v.webCrawlerId,siteId:pageRules.v.siteId,name:r,defaultValue:s,isAbsolute:Z,isCantNull:v,labelType:o,isOffset:J,startString:D,endString:F,mergeRules:W,excludeHtmlTags:O,mustContainText:g,cantContainText:X,excludeText:t,replaceText:c,regexFilter:ab,textLen:q,functionExpression:b,searchRegex:l,labelCombination:B,searchMode:x,filterSort:u,valueFromLabel:j,isPublic:k,filterInterId:h,filterPluginId:n,isDownload:A,fileSavePluginId:G,isTemp:L,isLoop:H,isStartPosition:y,isNested:U,isURL:f,nestedSiteId:Y,isConvertEncoding:w,convertEncode:C,isRegexMustContainText:Q,isRegexCantContainText:E,isRegexExcludeText:i,isRegexReplaceText:S,isDefaultValue:p,fileSavePluginRegex:T,fileSaveSubDir:e,absoluteUrlRegex:N,absoluteUrlBase:M,isDataOrigin:V,dataOrigin:K,javascriptFilter:a,isSingleMatch:R,textComposition:I,isHtmlPreprocess:aa,loopSplit:d,rulesVerId:crawlRules.v.rulesVerId,selectExpress:m,selectType:P})},removeAll:function(){var d="";var e=$(":checkbox[name=rules]");for(var b=0,a=e.length;b<a;b++){if(e[b].checked){if(d==""){d=e[b].value}else{d+=","+e[b].value}}}if(d==null||d==""){showInfo(nc.i18n("res.select.multi"));return}crawlRules.fn.remove(d)},remove:function(a){if(!confirm(nc.i18n("res.remove.confirm"))){return}a=""+a;showLoading($("#"+pageRules.v.formId));jsonrpc.crawlRulesService.remove(function(b,c,d){removeLoading($("#"+pageRules.v.formId));if(c){return}var e=b;if(!e){showInfo(nc.i18n("res.remove.failure"));return}crawlRules.fn.changeRulesVer(crawlRules.v.rulesVerId);showInfo(nc.i18n("res.remove.success"))},pageRules.v.webCrawlerId,pageRules.v.siteId,crawlRules.v.rulesVerId,a)},editInClickName:function(a){$("#"+crawlRules.v.tableId+" input[type=checkbox][name=rules]").each(function(){this.checked=false;if(this.value==a){this.checked=true}});crawlRules.fn.edit(a)},edit:function(f){if(f==null||f.length==0){showInfo(nc.i18n("res.select"));return}var d=crawlRules.v.jsonData;for(var c in d){if(isNaN(c)){continue}if(d[c]["id"]!=f){continue}$("#"+crawlRules.v.crawlRulesForm).find("#id").val(d[c]["id"]);selectCheckbox(crawlRules.v.crawlRulesForm,"isHtmlPreprocess",d[c]["isHtmlPreprocess"]);selectCheckbox(crawlRules.v.crawlRulesForm,"isAbsolute",d[c]["isAbsolute"]);crawlRules.fn.changeOption($("#"+crawlRules.v.crawlRulesForm).find("#isAbsolute").get(0));if(d[c]["isAbsolute"]=="true"){$("#"+crawlRules.v.crawlRulesForm).find("#absoluteUrlRegex").val(d[c]["absoluteUrlRegex"]);$("#"+crawlRules.v.crawlRulesForm).find("#absoluteUrlBase").val(d[c]["absoluteUrlBase"])}else{$("#"+crawlRules.v.crawlRulesForm).find("#absoluteUrlRegex").val("(?:href|src)=[\"'](.*?)[\"']");$("#"+crawlRules.v.crawlRulesForm).find("#absoluteUrlBase").val("")}selectCheckbox(crawlRules.v.crawlRulesForm,"isOffset",d[c]["isOffset"]);crawlRules.fn.changeOffset(d[c]["isOffset"],false);$("#"+crawlRules.v.crawlRulesForm).find("#filterInter").val(d[c]["filterInterId"]);$("#"+crawlRules.v.crawlRulesForm).find("#filterPlugin").val(d[c]["filterPluginId"]);selectCheckbox(crawlRules.v.crawlRulesForm,"isDownload",d[c]["isDownload"]);crawlRules.fn.changeOption($("#"+crawlRules.v.crawlRulesForm).find("#isDownload").get(0));if(d[c]["isDownload"]=="true"){var a=$("#"+crawlRules.v.crawlRulesForm).find("#fileSavePluginId option[value='"+d[c]["fileSavePluginId"]+"']").length;if(a<1){$("#"+crawlRules.v.crawlRulesForm).find("#fileSavePluginId").append("<option value=''/></option>")}$("#"+crawlRules.v.crawlRulesForm).find("#fileSavePluginId").val(d[c]["fileSavePluginId"]);$("#"+crawlRules.v.crawlRulesForm).find("#fileSavePluginRegex").val(d[c]["fileSavePluginRegex"]);$("#"+crawlRules.v.crawlRulesForm).find("#fileSaveSubDir").val(d[c]["fileSaveSubDir"])}else{$("#"+crawlRules.v.crawlRulesForm).find("#fileSavePluginId").val("");$("#"+crawlRules.v.crawlRulesForm).find("#fileSavePluginRegex").val("<\\s*img[^<]+src=[\"'](.*?)[\"'][^<]*?>");$("#"+crawlRules.v.crawlRulesForm).find("#fileSaveSubDir").val("")}selectCheckbox(crawlRules.v.crawlRulesForm,"isDefaultValue",d[c]["isDefaultValue"]);crawlRules.fn.changeOption($("#"+crawlRules.v.crawlRulesForm).find("#isDefaultValue").get(0));var e=false;$("#"+crawlRules.v.crawlRulesForm).find("#defaultValueSel option").each(function(){if(d[c]["defaultValue"]==this.value){e=true;this.selected=true}});if(!e){$("#"+crawlRules.v.crawlRulesForm).find("#defaultValueSel").val("");crawlRules.fn.defaultValueSel("");$("#"+crawlRules.v.crawlRulesForm).find("#defaultValue").val(d[c]["defaultValue"])}else{crawlRules.fn.defaultValueSel(d[c]["defaultValue"])}var b=d[c]["labelType"];if(b==null||b==""){b="1"}$("#"+crawlRules.v.crawlRulesForm).find("#labelType").val(b);selectCheckbox(crawlRules.v.crawlRulesForm,"isNested",d[c]["isNested"]);crawlRules.fn.changeOption($("#"+crawlRules.v.crawlRulesForm).find("#isNested").get(0));$("#"+crawlRules.v.crawlRulesForm).find("#nestedSiteId").val(d[c]["nestedSiteId"]);selectCheckbox(crawlRules.v.crawlRulesForm,"isURL",d[c]["isURL"]);selectCheckbox(crawlRules.v.crawlRulesForm,"isLoop",d[c]["isLoop"]);$("#"+crawlRules.v.crawlRulesForm).find("#loopSplit").val(d[c]["loopSplit"]);$("#"+crawlRules.v.crawlRulesForm).find("#valueFromLabel").val(d[c]["valueFromLabel"]);selectCheckbox(crawlRules.v.crawlRulesForm,"isDataOrigin",d[c]["isDataOrigin"]);crawlRules.fn.changeOption($("#"+crawlRules.v.crawlRulesForm).find("#isDataOrigin").get(0));$("#"+crawlRules.v.crawlRulesForm).find("#dataOrigin").val(d[c]["dataOrigin"]);crawlRules.fn.changeDataOrigin(d[c]["dataOrigin"]);selectCheckbox(crawlRules.v.crawlRulesForm,"isConvertEncoding",d[c]["isConvertEncoding"]);crawlRules.fn.changeOption($("#"+crawlRules.v.crawlRulesForm).find("#isConvertEncoding").get(0));$("#"+crawlRules.v.crawlRulesForm).find("#name").val(d[c]["name"]);$("#"+crawlRules.v.crawlRulesForm).find("#mergeRules").val(d[c]["mergeRules"]);$("#"+crawlRules.v.crawlRulesForm).find("#textComposition").val(d[c]["textComposition"]);$("#"+crawlRules.v.crawlRulesForm).find("#regexFilter").val(d[c]["regexFilter"]);selectCheckbox(crawlRules.v.crawlRulesForm,"isSingleMatch",d[c]["isSingleMatch"]);$("#"+crawlRules.v.crawlRulesForm).find("#javascriptFilter").val(d[c]["javascriptFilter"]);$("#"+crawlRules.v.crawlRulesForm).find("#textLen").val(d[c]["textLen"]);$("#"+crawlRules.v.crawlRulesForm).find("#functionExpression").val(d[c]["functionExpression"]);selectRadio(crawlRules.v.crawlRulesForm,"selectType",d[c]["selectType"]);selectRadio(crawlRules.v.crawlRulesForm,"searchMode",d[c]["searchMode"]);$("#"+crawlRules.v.crawlRulesForm).find("#selectExpress").val(d[c]["selectExpress"]);$("#"+crawlRules.v.crawlRulesForm).find("#labelCombination").val(d[c]["labelCombination"]);$("#"+crawlRules.v.crawlRulesForm).find("#searchRegex").val(d[c]["searchRegex"]);$("#"+crawlRules.v.crawlRulesForm).find("#startString").val(d[c]["startString"]);$("#"+crawlRules.v.crawlRulesForm).find("#endString").val(d[c]["endString"]);crawlRules.fn.changeHtmlPreprocess(d[c]["isHtmlPreprocess"],false);crawlRules.fn.initCheckboxByJson(d[c]["convertEncode"],"convertEncode");crawlRules.fn.initExcludeHtmlTags(d[c]["excludeHtmlTags"]);crawlRules.fn.initTextLabels("mustContainText",d[c]["mustContainText"]);crawlRules.fn.initTextLabels("cantContainText",d[c]["cantContainText"]);crawlRules.fn.initTextLabels("excludeText",d[c]["excludeText"]);crawlRules.fn.initTextLabels("replaceText",d[c]["replaceText"]);selectCheckbox(crawlRules.v.crawlRulesForm,"isRegexMustContainText",d[c]["isRegexMustContainText"]);selectCheckbox(crawlRules.v.crawlRulesForm,"isRegexCantContainText",d[c]["isRegexCantContainText"]);selectCheckbox(crawlRules.v.crawlRulesForm,"isRegexExcludeText",d[c]["isRegexExcludeText"]);selectCheckbox(crawlRules.v.crawlRulesForm,"isRegexReplaceText",d[c]["isRegexReplaceText"]);selectCheckbox(crawlRules.v.crawlRulesForm,"isCantNull",d[c]["isCantNull"]);selectCheckbox(crawlRules.v.crawlRulesForm,"isTemp",d[c]["isTemp"]);selectCheckbox(crawlRules.v.crawlRulesForm,"isPublic",d[c]["isPublic"]);selectCheckbox(crawlRules.v.crawlRulesForm,"isStartPosition",d[c]["isStartPosition"]);crawlRules.fn.changeSearchMode();crawlRules.fn.initTable();crawlRules.fn.sortTable(d[c]["filterSort"]);return}},update:function(){var H=$("#"+crawlRules.v.crawlRulesForm).find("#id").val();if(H==null||H.length==0){showInfo(nc.i18n("res.select"));return}var r=$("#"+crawlRules.v.crawlRulesForm).find("#name").val();var s=$("#"+crawlRules.v.crawlRulesForm).find("#defaultValue").val();var Z=getCheckbox(crawlRules.v.crawlRulesForm,"isAbsolute");var N=$("#"+crawlRules.v.crawlRulesForm).find("#absoluteUrlRegex").val();var M=$("#"+crawlRules.v.crawlRulesForm).find("#absoluteUrlBase").val();var v=getCheckbox(crawlRules.v.crawlRulesForm,"isCantNull");var o=$("#"+crawlRules.v.crawlRulesForm).find("#labelType").val();var J=getCheckbox(crawlRules.v.crawlRulesForm,"isOffset");var j=getCheckbox(crawlRules.v.crawlRulesForm,"isPublic");var aa=getCheckbox(crawlRules.v.crawlRulesForm,"isHtmlPreprocess");var W=$("#"+crawlRules.v.crawlRulesForm).find("#mergeRules").val();var I=$("#"+crawlRules.v.crawlRulesForm).find("#textComposition").val();var ab=$("#"+crawlRules.v.crawlRulesForm).find("#regexFilter").val();var R=getCheckbox(crawlRules.v.crawlRulesForm,"isSingleMatch");var a=$("#"+crawlRules.v.crawlRulesForm).find("#javascriptFilter").val();var q=$("#"+crawlRules.v.crawlRulesForm).find("#textLen").val();var b=$("#"+crawlRules.v.crawlRulesForm).find("#functionExpression").val();var P=getRadio(crawlRules.v.crawlRulesForm,"selectType");var y=getRadio(crawlRules.v.crawlRulesForm,"searchMode");var C=$("#"+crawlRules.v.crawlRulesForm).find("#startString").val();var E=$("#"+crawlRules.v.crawlRulesForm).find("#endString").val();var l=$("#"+crawlRules.v.crawlRulesForm).find("#searchRegex").val();var m=$("#"+crawlRules.v.crawlRulesForm).find("#selectExpress").val();var A=$("#"+crawlRules.v.crawlRulesForm).find("#labelCombination").val();var z=getCheckbox(crawlRules.v.crawlRulesForm,"isDownload");var F=$("#"+crawlRules.v.crawlRulesForm).find("#fileSavePluginId").val();var T=$("#"+crawlRules.v.crawlRulesForm).find("#fileSavePluginRegex").val();var e=$("#"+crawlRules.v.crawlRulesForm).find("#fileSaveSubDir").val();var h=$("#"+crawlRules.v.crawlRulesForm).find("#filterInter").val();var n=$("#"+crawlRules.v.crawlRulesForm).find("#filterPlugin").val();var L=getCheckbox(crawlRules.v.crawlRulesForm,"isTemp");var k=$("#"+crawlRules.v.crawlRulesForm).find("#valueFromLabel").val();var G=getCheckbox(crawlRules.v.crawlRulesForm,"isLoop");var d=$("#"+crawlRules.v.crawlRulesForm).find("#loopSplit").val();var x=getCheckbox(crawlRules.v.crawlRulesForm,"isStartPosition");var V=getCheckbox(crawlRules.v.crawlRulesForm,"isDataOrigin");var K=$("#"+crawlRules.v.crawlRulesForm).find("#dataOrigin").val();var U=getCheckbox(crawlRules.v.crawlRulesForm,"isNested");var f=getCheckbox(crawlRules.v.crawlRulesForm,"isURL");var Y=$("#"+crawlRules.v.crawlRulesForm).find("#nestedSiteId").val();var w=getCheckbox(crawlRules.v.crawlRulesForm,"isConvertEncoding");var u=crawlRules.fn.getSortIndex();var O=crawlRules.fn.getCheckBox2Json("excludeHtmlTags");var g=crawlRules.fn.getTextJson("mustContainTextDiv");var X=crawlRules.fn.getTextJson("cantContainTextDiv");var t=crawlRules.fn.getTextJson("excludeTextDiv");var c=crawlRules.fn.getTextJson("replaceTextDiv");var Q=getCheckbox(crawlRules.v.crawlRulesForm,"isRegexMustContainText");var D=getCheckbox(crawlRules.v.crawlRulesForm,"isRegexCantContainText");var i=getCheckbox(crawlRules.v.crawlRulesForm,"isRegexExcludeText");var S=getCheckbox(crawlRules.v.crawlRulesForm,"isRegexReplaceText");var p=getCheckbox(crawlRules.v.crawlRulesForm,"isDefaultValue");var s=$("#"+crawlRules.v.crawlRulesForm).find("#defaultValue").val();var B="";if(w=="true"){B=crawlRules.fn.getCheckBox2Json("convertEncode")}if(V!="true"){K="";k=""}else{if(K!="#DATAORIGIN_LABEL"&&K!="#DATAORIGIN_HEADER"){k=""}}if(p!="true"){s=""}if(z!="true"){F=null;T="";e=""}if(y=="regex"){C="";E="";m="";A=""}else{if(y=="string"){l="";m="";A=""}else{if(y=="xpath"||y=="csspath"){l="";C="";E="";A=""}else{if(y=="label"){l="";C="";E="";m=""}}}}showLoading($("#"+pageRules.v.formId));jsonrpc.crawlRulesService.update(function(ac,ad,ae){removeLoading($("#"+pageRules.v.formId));if(ad){return}var af=ac;if(af){crawlRules.fn.updateJson();crawlRules.fn.updateRow(H,r);showInfo(nc.i18n("res.update.success"))}else{showInfo(nc.i18n("res.update.failure"))}},{javaClass:"com.soso.web.jsonrpc.bo.CrawlRulesBo",id:H,webCrawlerId:pageRules.v.webCrawlerId,siteId:pageRules.v.siteId,name:r,defaultValue:s,isAbsolute:Z,isCantNull:v,labelType:o,isOffset:J,startString:C,endString:E,mergeRules:W,excludeHtmlTags:O,mustContainText:g,cantContainText:X,excludeText:t,replaceText:c,regexFilter:ab,textLen:q,functionExpression:b,searchRegex:l,labelCombination:A,searchMode:y,filterSort:u,valueFromLabel:k,isPublic:j,filterInterId:h,filterPluginId:n,isDownload:z,fileSavePluginId:F,isTemp:L,isLoop:G,isStartPosition:x,isNested:U,isURL:f,nestedSiteId:Y,isConvertEncoding:w,convertEncode:B,isRegexMustContainText:Q,isRegexCantContainText:D,isRegexExcludeText:i,isRegexReplaceText:S,isDefaultValue:p,fileSavePluginRegex:T,fileSaveSubDir:e,absoluteUrlRegex:N,absoluteUrlBase:M,isDataOrigin:V,dataOrigin:K,javascriptFilter:a,isSingleMatch:R,textComposition:I,isHtmlPreprocess:aa,loopSplit:d,rulesVerId:crawlRules.v.rulesVerId,selectExpress:m,selectType:P})},updateJson:function(){var c=$("#"+crawlRules.v.crawlRulesForm).find("#id").val();var b=crawlRules.v.jsonData;for(var a in b){if(isNaN(a)){continue}if(b[a]["id"]!=c){continue}b[a]=crawlRules.fn.getJsonData(c)}},createJson:function(c){var b=crawlRules.v.jsonData;if(b==null){b=new Array()}var a=crawlRules.fn.getJsonData(c);b.push(a);crawlRules.v.jsonData=b},getJsonData:function(v){var t=getRadio(crawlRules.v.crawlRulesForm,"selectType");var B=getRadio(crawlRules.v.crawlRulesForm,"searchMode");var r=$("#"+crawlRules.v.crawlRulesForm).find("#startString").val();var a=$("#"+crawlRules.v.crawlRulesForm).find("#endString").val();var z=$("#"+crawlRules.v.crawlRulesForm).find("#searchRegex").val();var n=$("#"+crawlRules.v.crawlRulesForm).find("#selectExpress").val();var C=$("#"+crawlRules.v.crawlRulesForm).find("#labelCombination").val();var w=getCheckbox(crawlRules.v.crawlRulesForm,"isAbsolute");var q=$("#"+crawlRules.v.crawlRulesForm).find("#absoluteUrlRegex").val();var h=$("#"+crawlRules.v.crawlRulesForm).find("#absoluteUrlBase").val();var D=getCheckbox(crawlRules.v.crawlRulesForm,"isDownload");var E=$("#"+crawlRules.v.crawlRulesForm).find("#fileSavePluginId").val();var o=$("#"+crawlRules.v.crawlRulesForm).find("#fileSavePluginRegex").val();var d=$("#"+crawlRules.v.crawlRulesForm).find("#fileSaveSubDir").val();var u=getCheckbox(crawlRules.v.crawlRulesForm,"isDataOrigin");var e=$("#"+crawlRules.v.crawlRulesForm).find("#dataOrigin").val();var c=$("#"+crawlRules.v.crawlRulesForm).find("#valueFromLabel").val();var k=getCheckbox(crawlRules.v.crawlRulesForm,"isConvertEncoding");var g=getCheckbox(crawlRules.v.crawlRulesForm,"isRegexMustContainText");var A=getCheckbox(crawlRules.v.crawlRulesForm,"isRegexCantContainText");var j=getCheckbox(crawlRules.v.crawlRulesForm,"isRegexExcludeText");var i=getCheckbox(crawlRules.v.crawlRulesForm,"isRegexReplaceText");var p=getCheckbox(crawlRules.v.crawlRulesForm,"isDefaultValue");var x=$("#"+crawlRules.v.crawlRulesForm).find("#defaultValue").val();var y="";if(k=="true"){y=crawlRules.fn.getCheckBox2Json("convertEncode")}if(B=="regex"){r="";a="";n="";C=""}else{if(B=="string"){z="";n="";C=""}else{if(B=="xpath"||B=="csspath"){z="";r="";a="";C=""}else{if(B=="label"){z="";r="";a="";n=""}}}}if(u!="true"){e="";c=""}if(p!="true"){x=""}if(D!="true"){E=null;o="";d=""}if(w!="true"){q="";h=""}var s=crawlRules.fn.getTextJson("mustContainTextDiv");if(s){s=JSON.parse(s)}var b=crawlRules.fn.getTextJson("cantContainTextDiv");if(b){b=JSON.parse(b)}var m=crawlRules.fn.getTextJson("excludeTextDiv");if(m){m=JSON.parse(m)}var l=crawlRules.fn.getTextJson("replaceTextDiv");if(l){l=JSON.parse(l)}var f={id:v,selectType:t,searchMode:B,startString:r,endString:a,searchRegex:z,selectExpress:n,labelCombination:C,isDownload:D,fileSavePluginId:E,fileSavePluginRegex:o,fileSaveSubDir:d,valueFromLabel:c,filterSort:crawlRules.fn.getSortIndex(),excludeHtmlTags:crawlRules.fn.getCheckBox2Json("excludeHtmlTags"),name:$("#"+crawlRules.v.crawlRulesForm).find("#name").val(),isAbsolute:w,absoluteUrlRegex:q,absoluteUrlBase:h,isCantNull:getCheckbox(crawlRules.v.crawlRulesForm,"isCantNull"),labelType:$("#"+crawlRules.v.crawlRulesForm).find("#labelType").val(),isOffset:getCheckbox(crawlRules.v.crawlRulesForm,"isOffset"),isPublic:getCheckbox(crawlRules.v.crawlRulesForm,"isPublic"),mergeRules:$("#"+crawlRules.v.crawlRulesForm).find("#mergeRules").val(),textComposition:$("#"+crawlRules.v.crawlRulesForm).find("#textComposition").val(),regexFilter:$("#"+crawlRules.v.crawlRulesForm).find("#regexFilter").val(),javascriptFilter:$("#"+crawlRules.v.crawlRulesForm).find("#javascriptFilter").val(),textLen:$("#"+crawlRules.v.crawlRulesForm).find("#textLen").val(),functionExpression:$("#"+crawlRules.v.crawlRulesForm).find("#functionExpression").val(),filterInter:$("#"+crawlRules.v.crawlRulesForm).find("#filterInter").val(),filterPlugin:$("#"+crawlRules.v.crawlRulesForm).find("#filterPlugin").val(),isTemp:getCheckbox(crawlRules.v.crawlRulesForm,"isTemp"),mustContainText:s,cantContainText:b,excludeText:m,replaceText:l,isLoop:getCheckbox(crawlRules.v.crawlRulesForm,"isLoop"),isStartPosition:getCheckbox(crawlRules.v.crawlRulesForm,"isStartPosition"),isNested:getCheckbox(crawlRules.v.crawlRulesForm,"isNested"),isURL:getCheckbox(crawlRules.v.crawlRulesForm,"isURL"),nestedSiteId:$("#"+crawlRules.v.crawlRulesForm).find("#nestedSiteId").val(),isConvertEncoding:k,convertEncode:y,isRegexMustContainText:g,isRegexCantContainText:A,isRegexExcludeText:j,isRegexReplaceText:i,isDefaultValue:p,defaultValue:x,isDataOrigin:u,dataOrigin:e,isSingleMatch:getCheckbox(crawlRules.v.crawlRulesForm,"isSingleMatch"),isHtmlPreprocess:getCheckbox(crawlRules.v.crawlRulesForm,"isHtmlPreprocess"),loopSplit:$("#"+crawlRules.v.crawlRulesForm).find("#loopSplit").val()};return f},changeSearchMode:function(){var a=getRadio(crawlRules.v.crawlRulesForm,"searchMode");if(a=="regex"){$("#"+crawlRules.v.crawlRulesForm).find("#regexLabel").css("display","block");$("#"+crawlRules.v.crawlRulesForm).find("#selectLabel").css("display","none");$("#"+crawlRules.v.crawlRulesForm).find("#stringLabel").css("display","none");$("#"+crawlRules.v.crawlRulesForm).find("#labelLabel").css("display","none")}else{if(a=="string"){$("#"+crawlRules.v.crawlRulesForm).find("#stringLabel").css("display","block");$("#"+crawlRules.v.crawlRulesForm).find("#regexLabel").css("display","none");$("#"+crawlRules.v.crawlRulesForm).find("#selectLabel").css("display","none");$("#"+crawlRules.v.crawlRulesForm).find("#labelLabel").css("display","none")}else{if(a=="xpath"||a=="csspath"){if(a=="xpath"){$("#"+crawlRules.v.crawlRulesForm).find("#xpath_tools").css("display","block")}else{$("#"+crawlRules.v.crawlRulesForm).find("#xpath_tools").css("display","none")}$("#"+crawlRules.v.crawlRulesForm).find("#stringLabel").css("display","none");$("#"+crawlRules.v.crawlRulesForm).find("#regexLabel").css("display","none");$("#"+crawlRules.v.crawlRulesForm).find("#selectLabel").css("display","block");$("#"+crawlRules.v.crawlRulesForm).find("#labelLabel").css("display","none")}else{if(a=="label"){$("#"+crawlRules.v.crawlRulesForm).find("#stringLabel").css("display","none");$("#"+crawlRules.v.crawlRulesForm).find("#regexLabel").css("display","none");$("#"+crawlRules.v.crawlRulesForm).find("#selectLabel").css("display","none");$("#"+crawlRules.v.crawlRulesForm).find("#labelLabel").css("display","block")}}}}},changeHtmlPreprocess:function(a,b){selectCheckbox(crawlRules.v.crawlRulesForm,"isPublic",a);$("#"+crawlRules.v.crawlRulesForm).find("#isPublic")[0].disabled=a;selectCheckbox(crawlRules.v.crawlRulesForm,"isTemp",a);$("#"+crawlRules.v.crawlRulesForm).find("#isTemp")[0].disabled=a;selectCheckbox(crawlRules.v.crawlRulesForm,"isCantNull",a);$("#"+crawlRules.v.crawlRulesForm).find("#isCantNull")[0].disabled=a;$("#"+crawlRules.v.crawlRulesForm).find("#isOffset")[0].disabled=a;if(b){selectCheckbox(crawlRules.v.crawlRulesForm,"isOffset",false)}},changeOffset:function(c,d){if(c){if($("#"+crawlRules.v.crawlRulesForm).find("#name").val()==""){$("#"+crawlRules.v.crawlRulesForm).find("#name").val(nc.i18n("res.offset"))}selectRadio(crawlRules.v.crawlRulesForm,"searchMode","regex")}else{var e=$("#"+crawlRules.v.crawlRulesForm).find("#id").val();var b=crawlRules.v.jsonData;for(var a in b){if(isNaN(a)){continue}if(b[a]["id"]==e){selectRadio(crawlRules.v.crawlRulesForm,"searchMode",b[a]["searchMode"]);break}}}$("#"+crawlRules.v.crawlRulesForm).find("#isHtmlPreprocess")[0].disabled=c;$("#"+crawlRules.v.crawlRulesForm).find("#isCantNull")[0].disabled=c;$("#"+crawlRules.v.crawlRulesForm).find("#isTemp")[0].disabled=c;if(d){selectCheckbox(crawlRules.v.crawlRulesForm,"isHtmlPreprocess",false);selectCheckbox(crawlRules.v.crawlRulesForm,"isCantNull",false);selectCheckbox(crawlRules.v.crawlRulesForm,"isTemp",false)}crawlRules.fn.changeSearchMode();crawlRules.fn.changeDisabled()},changeDisabled:function(){var f=$("#"+crawlRules.v.crawlRulesForm).find("#isOffset").attr("checked");var b=$("#"+crawlRules.v.crawlRulesForm).find("#isDataOrigin").attr("checked");var h=$("#"+crawlRules.v.crawlRulesForm).find(":radio[name=searchMode]");for(var d=0,a=h.length;d<a;d++){if(h[d].value=="string"){h[d].disabled=f}else{if(h[d].value=="xpath"||h[d].value=="csspath"||h[d].value=="label"){var e=(f||b);if(e){var g=getRadio(crawlRules.v.crawlRulesForm,"searchMode");if(g=="xpath"||g=="csspath"||g=="label"){selectRadio(crawlRules.v.crawlRulesForm,"searchMode","regex")}}h[d].disabled=e}}}},changeOption:function(c){if(c.checked){$("#"+crawlRules.v.crawlRulesForm).find("#"+c.id+"_option").css("display","block")}else{$("#"+crawlRules.v.crawlRulesForm).find("#"+c.id+"_option").css("display","none")}$("#"+crawlRules.v.tableId).find("#optionTable tr:visible:odd").css("background","#FFFFFF");$("#"+crawlRules.v.tableId).find("#optionTable tr:visible:even").css("background","rgb(247, 247, 247)");crawlRules.fn.changeDisabled();if(c.id=="isDataOrigin"){var a=$("#"+crawlRules.v.crawlRulesForm).find("#isDataOrigin").attr("checked");if(a){var b=$("#"+crawlRules.v.crawlRulesForm).find("#dataOrigin").val();crawlRules.fn.changeDataOrigin(b)}else{crawlRules.fn.changeDataOrigin("")}}},changeDataOrigin:function(a){if(a=="#DATAORIGIN_LABEL"){$("#"+crawlRules.v.crawlRulesForm).find("#valueFromLabelOption").css("display","block");$("#"+crawlRules.v.crawlRulesForm).find("#valueFromLabelOption").find(".header").css("display","none");$("#"+crawlRules.v.crawlRulesForm).find("#valueFromLabelOption").find(".label").css("display","block")}else{if(a=="#DATAORIGIN_HEADER"){$("#"+crawlRules.v.crawlRulesForm).find("#valueFromLabelOption").css("display","block");$("#"+crawlRules.v.crawlRulesForm).find("#valueFromLabelOption").find(".label").css("display","none");$("#"+crawlRules.v.crawlRulesForm).find("#valueFromLabelOption").find(".header").css("display","block")}else{$("#"+crawlRules.v.crawlRulesForm).find("#valueFromLabelOption").css("display","none")}}},show:function(h){var d=$("#"+crawlRules.v.crawlRulesForm).find("#name").val();var f=$("#"+crawlRules.v.crawlRulesForm).find("#startString").val();var g=$("#"+crawlRules.v.crawlRulesForm).find("#endString").val();var c=$("#"+crawlRules.v.crawlRulesForm).find("#labelType").val();var b=getCheckbox(crawlRules.v.crawlRulesForm,"isDataOrigin");var e=$("#"+crawlRules.v.crawlRulesForm).find("#dataOrigin").val();var a=$("#"+crawlRules.v.crawlRulesForm).find("#valueFromLabel").val();crawlRules.fn.addRow(h,d,f,g,c,b,e,a)},selectAll:function(e,g,d){var f=$("#"+g).find(":checkbox[name="+d+"]");for(var b=0,a=f.length;b<a;b++){f[b].checked=e.checked}},sortRules:function(a,d){var c="";if(a=="2"){c="pageLabelTabel"}else{c="crawlLabelTabel"}var b=$("#"+crawlRules.v.tableId).find("#"+c).find("#sortable").sortable("toArray");jsonrpc.crawlRulesService.move(function(e,f,g){if(!e){$("#"+crawlRules.v.tableId).find("#"+c).find("#sortable").sortable("cancel");return}$("#"+crawlRules.v.tableId).find("#"+c).find("#sortable>li").each(function(h){$(this).find(".left span").text(h+1+".")});$("#"+crawlRules.v.tableId).find("#"+c).find("li:odd").css("background","rgb(248, 248, 248)");$("#"+crawlRules.v.tableId).find("#"+c).find("li:even").css("background","rgb(255, 255, 255)")},pageRules.v.webCrawlerId,pageRules.v.siteId,crawlRules.v.rulesVerId,b,a)},updateRow:function(e,c){var b=getCheckbox(crawlRules.v.crawlRulesForm,"isDataOrigin");var d=$("#"+crawlRules.v.crawlRulesForm).find("#dataOrigin").val();var a=$("#"+crawlRules.v.crawlRulesForm).find("#valueFromLabel").val();$("#"+crawlRules.v.tableId).find("ul").find("#"+e).find("#rules_name").text(c);$("#"+crawlRules.v.tableId).find("ul").find("#"+e).find("#rules_name").attr("title",c);if(b=="true"&&(d=="#DATAORIGIN_LABEL"||d=="#DATAORIGIN_HEADER")){$("#"+crawlRules.v.tableId).find("ul").find("#"+e).find(".parent").addClass("child").removeClass("parent")}else{$("#"+crawlRules.v.tableId).find("ul").find("#"+e).find(".child").addClass("parent").removeClass("child")}},addRow:function(c,b,i,j,a,f,k,h){var d="";var g=1;if(a=="2"){d="pageLabelTabel";crawlRules.v.pageLabelIndex=crawlRules.v.pageLabelIndex+1;g=crawlRules.v.pageLabelIndex}else{d="crawlLabelTabel";crawlRules.v.commonLabelIndex=crawlRules.v.commonLabelIndex+1;g=crawlRules.v.commonLabelIndex}var e='<li id="'+c+'" class="simplehighlight">';if(f=="true"&&(k=="#DATAORIGIN_LABEL"||k=="#DATAORIGIN_HEADER")){e+='<span class="child"></span>'}else{e+='<span class="parent"></span>'}e+='<div class="right ui-state-default"><span class="ui-icon ui-icon-trash" title="Delete" onclick="crawlRules.fn.remove('+c+')">Delete</span><span class="ui-icon ui-icon-arrow-4" title="Move">Move</span></div><div class="left"><input type="checkbox" id="rules" name="rules" value = "'+c+'"><span>'+g+'.</span></div><div class="middle"><div class="content" id="rules_name" onclick="crawlRules.fn.editInClickName('+c+');" title="'+b+'">'+b+"</div></div></li>";$("#"+crawlRules.v.tableId).find("#"+d).find("ul").append(e);$("#"+crawlRules.v.tableId).find("#"+d).find("li:odd").css("background","rgb(248, 248, 248)");$("#"+crawlRules.v.tableId).find("#"+d).find("li:even").css("background","rgb(255, 255, 255)");$("#"+crawlRules.v.tableId).find("#"+d).find(".simplehighlight").hover(function(){$(this).addClass("datahighlight")},function(){$(this).removeClass("datahighlight")})},viewCode:function(){var a=$("#"+crawlRules.v.tableId).find("#crawlUrl").val();a=BASE64.encode(a);a=encodeURIComponent(a);var b="../tools/code.html?webCrawlerId="+pageRules.v.webCrawlerId+"&siteId="+pageRules.v.siteId+"&u="+a;window.open(b)},xpathTools:function(){var c="http://www.newcrawler.com/static/xpath/mark-min.js";var a="var newcrawler_server_url='http://www.newcrawler.com/'; var script = document.createElement('script'); script.setAttribute('type', 'text/javascript'); script.setAttribute('charset', 'UTF-8'); script.src='"+c+"?'+Math.floor(+new Date/1e7); document.body.appendChild(script);";var d="javascript: (function() { "+a+" })()";var b="<div class='button white'>"+nc.i18n("res.crawler.rules.xpath.button")+"<a title='"+nc.i18n("res.crawler.rules.xpath.title")+"' href=\""+d+'" onclick=\'alert("'+nc.i18n("res.crawler.rules.xpath.alert")+"\");return false;' class='mask-button'>"+nc.i18n("res.crawler.rules.xpath.title")+"</a></div>";document.getElementById("xpath_tools").innerHTML=b},readXPath:function(){var b=$("#"+crawlRules.v.tableId).find("#crawlUrl").val();b=BASE64.encode(b);b=encodeURIComponent(b);var a=document.location.href;a=a.substring((a.indexOf("://")+3),a.indexOf("/member/index.html"));a=a.substring(0,a.lastIndexOf("/"));var c="http://"+a+"/member/readxpath?webCrawlerId="+pageRules.v.webCrawlerId+"&siteId="+pageRules.v.siteId+"&rulesVerId="+crawlRules.v.rulesVerId+"&u="+b;window.open(c)},importRules:function(){var a=$("#"+crawlRules.v.tableId).find("#crawlUrl").val();showLoading($("#"+pageRules.v.formId));jsonrpc.crawlRulesService.importRules(function(b,c,d){if(c){removeLoading($("#"+pageRules.v.formId));return}crawlRules.v.pageLabelIndex=0;crawlRules.v.commonLabelIndex=0;if(crawlRules.v.rulesVerId==null||crawlRules.v.rulesVerId===""){crawlRules.fn.queryVer()}else{removeLoading($("#"+pageRules.v.formId));crawlRules.fn.changeRulesVer(crawlRules.v.rulesVerId)}var e=b;if(e){showInfo(nc.i18n("res.import.rules.success"))}else{showInfo(nc.i18n("res.import.rules.failure"))}},pageRules.v.webCrawlerId,pageRules.v.siteId,crawlRules.v.rulesVerId,a)},exportRules:function(){jsonrpc.crawlRulesService.exportRules(function(a,b,c){var d=a;$("#"+crawlRules.v.tableId).find("#crawlUrl").val(d)},pageRules.v.webCrawlerId,pageRules.v.siteId,crawlRules.v.rulesVerId)},addExcludeHtmlTag:function(a){a=replaceHtmlStr(a);var e=false;var g=$("#"+crawlRules.v.crawlRulesForm).find("input[name=excludeHtmlTags]");for(var c=0,f=g.length;c<f;c++){var d=replaceHtmlStr(g[c].value);if(a==d){g[c].checked=true;e=true;break}}if(!e){var b='<li><input name="excludeHtmlTags" type="checkbox" id="excludeHtmlTags" value="'+a+'" checked="checked" >'+a+"</li>";$(b).appendTo("#"+crawlRules.v.crawlRulesForm+" #excludeHtmlTagsDiv ul")}if(e){showInfo(nc.i18n("res.rules.isExist"));return false}return true},initExcludeHtmlTags:function(htmlTagsJson){var excludeHtmlTags=$("#"+crawlRules.v.crawlRulesForm).find("input[name=excludeHtmlTags]");for(var i=0,len=excludeHtmlTags.length;i<len;i++){excludeHtmlTags[i].checked=false}if(htmlTagsJson==null||htmlTagsJson==""){return}var htmlTagsJsonJsonObj=eval(htmlTagsJson);for(var i=0,len=htmlTagsJsonJsonObj.length;i<len;i++){var htmlTag=htmlTagsJsonJsonObj[i];htmlTag=replaceHtmlStr(htmlTag);var isExist=false;for(var j=0,jLen=excludeHtmlTags.length;j<jLen;j++){var tempTag=replaceHtmlStr(excludeHtmlTags[j].value);if(htmlTag==tempTag){excludeHtmlTags[j].checked=true;isExist=true;break}}if(!isExist){var label='<li><input name="excludeHtmlTags" type="checkbox" id="excludeHtmlTags" value="'+htmlTag+'" checked="checked" >'+htmlTag+"</li>";$(label).appendTo("#"+crawlRules.v.crawlRulesForm+" #excludeHtmlTagsDiv ul")}}return isExist},addTextLabel:function(b,f){var e=false;$("#"+crawlRules.v.crawlRulesForm).find("#"+b+"Div").find("ul li a").each(function(){var g=$(this).text();if(g==f){e=true;return}});if(e){showInfo(nc.i18n("res.rules.isExist.text"));return false}f=replaceHtmlStr(f);var a="#"+crawlRules.v.crawlRulesForm+" #"+b+"Div ul";var d='<li><a href="javascript:void(0)" onclick="crawlRules.fn.'+b+'AddBox(this)" title="'+f+'">'+f+'</a><span class="ui-state-default" style="border: none"><span class="ui-icon ui-icon-close" style="float: left; cursor: pointer;">Close</span><span class="ui-icon ui-icon-arrow-4" style="float: left; cursor: move;">Move</span></span></li>';$(d).appendTo(a);var c="#"+crawlRules.v.crawlRulesForm+" #"+b+"Div ul li span.ui-icon-close";$(c).click(function(){$(this).parent().parent().remove();return false});$("#"+crawlRules.v.tableId).find("#sortDiv").find(".sortable").sortable({handle:".ui-icon-arrow-4",update:function(g,h){}}).disableSelection()},initTextLabels:function(j,g){var a="#"+crawlRules.v.crawlRulesForm+" #"+j+"Div ul";$(a).find("li:not(.notRemove)").remove();if(g==null||g==""){return}var e=false;var f="#"+crawlRules.v.crawlRulesForm+" #"+j+"Div ul li a";for(var c=0,d=g.length;c<d;c++){var k=replaceHtmlStr(g[c]);$(f).each(function(){var i=$(this).text();if(k==i){e=true;return}});if(!e){var h='<li><a href="javascript:void(0)" onclick="crawlRules.fn.'+j+'AddBox(this)" title="'+k+'">'+k+'</a><span class="ui-state-default" style="border: none"><span class="ui-icon ui-icon-close" style="float: left; cursor: pointer;">Close</span><span class="ui-icon ui-icon-arrow-4" style="float: left; cursor: move;">Move</span><span></li>';$(h).appendTo(a)}}var b="#"+crawlRules.v.crawlRulesForm+" #"+j+"Div ul li span.ui-icon-close";$(b).click(function(){$(this).parent().parent().remove();return false});$("#"+crawlRules.v.tableId).find("#sortDiv").find(".sortable").sortable({handle:".ui-icon-arrow-4",update:function(i,l){}}).disableSelection();return e},initCheckboxByJson:function(jsonString,eleName){var checkboxs=$("#"+crawlRules.v.crawlRulesForm).find("input[name='"+eleName+"']");for(var i=0,len=checkboxs.length;i<len;i++){checkboxs[i].checked=false}if(jsonString==null||jsonString==""){return}var jsonObj=eval(jsonString);for(var i=0,len=jsonObj.length;i<len;i++){var v=jsonObj[i];for(var j=0,jLen=checkboxs.length;j<jLen;j++){if(checkboxs[j].value==v){checkboxs[j].checked=true;break}}}},getCheckBox2Json:function(c){var a=new Array();$("#"+crawlRules.v.crawlRulesForm).find("input[id='"+c+"']").each(function(){if(this.checked){a.push(this.value)}});var b=toJson(a);return b},getTextJson:function(c){var b=new Array();var d="#"+crawlRules.v.crawlRulesForm+" #"+c+" ul li:not(.notRemove) a";$(d).each(function(){var e=$(this).text();b.push(e)});var a=toJson(b);return a},moveRules:function(b,a){jsonrpc.crawlRulesService.move(function(c,d,e){var f=c;if(f){crawlRules.fn.changeRulesVer(crawlRules.v.rulesVerId);$("#"+crawlRules.v.tableId).find("#tr_"+b).addClass("moveRulesBorder")}},pageRules.v.webCrawlerId,pageRules.v.siteId,crawlRules.v.rulesVerId,b,a)},nextMoveTrCommand:function(d,b){var e=$(d).parent().parent();var a=e[0].rowIndex;var c=$("#"+crawlRules.v.crawlRulesForm).find("#"+b+" tr");c.eq(a).insertAfter(c.eq(a+1))},prevMoveTrCommand:function(d,b){var e=$(d).parent().parent();var a=e[0].rowIndex;var c=$("#"+crawlRules.v.crawlRulesForm).find("#"+b+" tr");c.eq(a).insertBefore(c.eq(a-1))},initTable:function(){var a=$("#"+crawlRules.v.crawlRulesForm).find("table[id='sort_table'] tr").get();$.each(a,function(b,d){var e=$(d).find("td input[name='tdIndex']").val();var c=$(d).find("td input[name='sortIndex']").val();$(d).find("td input[name='tdIndex']").val(c)});crawlRules.fn.freshTable()},getSortIndex:function(){var d="";var b=$("#"+crawlRules.v.crawlRulesForm).find(":input[name=sortIndex]");for(var c=0,a=b.length;c<a;c++){if(d===""){d=b[c].value}else{d+=","+b[c].value}}return d},sortTable:function(d){if(d==null||d==""){d=crawlRules.fn.getSortIndex()}var f=d.split(",");var g=$("#"+crawlRules.v.crawlRulesForm).find(":input[name=tdIndex]");for(var c=0,a=g.length;c<a;c++){try{var b=f[c];g[b].value=c}catch(h){}}crawlRules.fn.freshTable()},freshTable:function(){var a=$("#"+crawlRules.v.crawlRulesForm).find("table[id='sort_table'] tr").get();a=a.sort(function(f,d){var e=$(f).find("td input[name='tdIndex']").val();var c=$(d).find("td input[name='tdIndex']").val();var f=Number(e);var d=Number(c);if(f<d){return -1}else{if(f>d){return 1}else{return 0}}});$.each(a,function(b,c){$("#"+crawlRules.v.crawlRulesForm).find("table[id='sort_table']").append(c)})},testRules:function(){var d="";var f=$("#"+crawlRules.v.tableId).find(":checkbox[name=rules]");for(var b=0,a=f.length;b<a;b++){if(f[b].checked){if(d==""){d=f[b].value}else{d+=","+f[b].value}}}$("#"+crawlRules.v.tableId).find("#crawlResult").val(nc.i18n("res.fetch"));$("#tabsview > .ui-layout-content > div.ui-tabs-panel[aria-hidden='false']").animate({scrollTop:$("#tabsview > .ui-layout-content > div.ui-tabs-panel[aria-hidden='false']")[0].scrollHeight},1500);var e=$("#"+crawlRules.v.tableId).find("#crawlUrl").val();jsonrpc.crawlRulesService.crawlTest(function(c,g,h){$("#"+crawlRules.v.tableId).find("#crawlResult").val(c)},pageRules.v.webCrawlerId,pageRules.v.siteId,crawlRules.v.rulesVerId,e,d)},excludeHtmlTagsAddBox:function(){easyDialog.open({container:{header:nc.i18n("res.rules.htmlLabel.title"),content:'<label style="width:120px; text-align:right">'+nc.i18n("res.rules.htmlLabel")+'</label> <input id="htmlTagInput" name="htmlTagInput" size="33" type="text"></input>',yesFn:function(){var a=document.getElementById("htmlTagInput").value;if(a==null||""==a){showInfo(nc.i18n("res.rules.null.htmlLabel"));return false}return crawlRules.fn.addExcludeHtmlTag(a)},noFn:true}})},mustContainTextAddBox:function(b){var a="";if(b!=null){a=replaceHtmlStr($(b).text())}easyDialog.open({container:{header:nc.i18n("res.rules.mustContainText.title"),content:'<label style="width:120px; text-align:right">'+nc.i18n("res.rules.mustContainText")+'</label> <input id="mustContainTextInput" name="mustContainTextInput" size="35" type="text" class="regex" value="'+a+'"></input>',yesFn:function(){var c=document.getElementById("mustContainTextInput").value;if(c==null||""==c){showInfo(nc.i18n("res.rules.null.mustContainText"));return false}if(b!=null){$(b).text(c)}else{crawlRules.fn.addTextLabel("mustContainText",c)}return true},noFn:true}})},cantContainTextAddBox:function(b){var a="";if(b!=null){a=replaceHtmlStr($(b).text())}easyDialog.open({container:{header:nc.i18n("res.rules.cantContainText.title"),content:'<label style="width:120px; text-align:right">'+nc.i18n("res.rules.cantContainText")+'</label> <input id="cantContainTextInput" name="cantContainTextInput" size="35" type="text" class="regex" value="'+a+'"></input>',yesFn:function(){var c=document.getElementById("cantContainTextInput").value;if(c==null||""==c){showInfo(nc.i18n("res.rules.null.cantContainText"));return false}if(b!=null){$(b).text(c)}else{crawlRules.fn.addTextLabel("cantContainText",c)}return true},noFn:true}})},excludeTextAddBox:function(b){var a="";if(b!=null){a=replaceHtmlStr($(b).text())}easyDialog.open({fixed:false,container:{header:nc.i18n("res.rules.excludeText.title"),content:'<label style="width:120px; text-align:right">'+nc.i18n("res.rules.excludeText")+'</label> <input id="excludeTextInput" name="excludeTextInput" size="35" type="text" class="regex" value="'+a+'"></input>',yesFn:function(){var c=document.getElementById("excludeTextInput").value;if(c==null||""==c){showInfo(nc.i18n("res.rules.null.excludeText"));return false}if(b!=null){$(b).text(c)}else{crawlRules.fn.addTextLabel("excludeText",c)}return true},noFn:true}})},replaceTextAddBox:function(c){var a="";var b="";if(c!=null){var d=$(c).text().split(" > ",2);a=replaceHtmlStr(d[0]);b=replaceHtmlStr(d[1])}easyDialog.open({container:{header:nc.i18n("res.rules.replaceText.title"),content:'<div style="margin-bottom: 5px;"><label style="width:120px; text-align:right">'+nc.i18n("res.rules.replaceText.old")+'</label> <input id="replaceTextOldInput" name="replaceTextOldInput" size="33" type="text" class="regex" value="'+a+'"></input></div><div><label style="width:120px; text-align:right">'+nc.i18n("res.rules.replaceText.new")+'</label> <input id="replaceTextNewInput" name="replaceTextNewInput" size="33" type="text" class="regex" value="'+b+'"></input></div>',yesFn:function(){var f=document.getElementById("replaceTextOldInput").value;var g=document.getElementById("replaceTextNewInput").value;if(f==null||""==f){showInfo(nc.i18n("res.rules.null.replaceText.old"));return false}if(g==null){g=""}var e=f+" > "+g;if(c!=null){$(c).text(e)}else{crawlRules.fn.addTextLabel("replaceText",e)}return true},noFn:true}})},changeUrlStatusTextAddBox:function(a){var b="";if(a!=null){b=replaceHtmlStr($(a).text())}easyDialog.open({container:{header:nc.i18n("res.rules.changeUrlStatusText.title"),content:'<label style="width:120px; text-align:right">'+nc.i18n("res.rules.changeUrlStatusText")+'</label> <input id="changeUrlStatusTextInput" name="changeUrlStatusTextInput" size="35" type="text" class="regex" value="'+b+'"></input>',yesFn:function(){var c=document.getElementById("changeUrlStatusTextInput").value;if(c==null||""==c){showInfo(nc.i18n("res.rules.changeUrlStatusText.null"));return false}if(a!=null){$(a).text(c)}else{crawlRules.fn.addTextLabel("changeUrlStatusText",c)}return true},noFn:true}})},sortRulesVer:function(b){var a=$("#"+crawlRules.v.tableId).find("#rulesVersion").find("#sortable").sortable("toArray");jsonrpc.crawlRulesVerService.move(function(c,d,e){if(!c){$("#"+crawlRules.v.tableId).find("#rulesVersion").find("#sortable").sortable("cancel");return}},pageRules.v.webCrawlerId,pageRules.v.siteId,a)},deleteRulesVer:function(a,b){if(!confirm(nc.i18n("res.remove.confirm"))){return}jsonrpc.crawlRulesVerService.remove(function(c,d,f){if(c){var e=$(a).parent().parent().next();if(e.length<1){e=$(a).parent().parent().prev()}if($(a).parent().parent().hasClass("cur")){$("#"+crawlRules.v.tableId).find("#crawlLabelTabel").find("#sortable").empty();$("#"+crawlRules.v.tableId).find("#pageLabelTabel").find("#sortable").empty()}if(e.length>0){crawlRules.fn.changeRulesVer(e.attr("id"))}else{crawlRules.v.rulesVerId=null}$(a).parent().parent().remove();removeSelect(b,"crawlRulesVerId")}else{showInfo(nc.i18n("res.remove.failure"))}},pageRules.v.webCrawlerId,pageRules.v.siteId,b)},addRulesVer:function(b,a){$("#"+crawlRules.v.tableId).find("#rulesVersion").find("ul").append('<li id="'+b+'"><div onclick="crawlRules.fn.changeRulesVer('+b+')" ondblclick="crawlRules.fn.rulesVersionEditBox(this, '+b+')"  title="'+a+'">'+a+'</div><span style="float: right;border: none;background: none;cursor: none;" class="ui-state-default"><span class="ui-icon ui-icon-trash" title="Delete" onclick="crawlRules.fn.deleteRulesVer(this, '+b+')">Delete</span><span class="ui-icon ui-icon-arrow-4" title="Move">Move</span></span></li>')},changeRulesVer:function(a){crawlRules.fn.query(a);crawlRules.v.rulesVerId=a;$("#"+crawlRules.v.tableId).find("#rulesVersion").find("li").removeClass("cur");$("#"+crawlRules.v.tableId).find("#rulesVersion").find("#"+a).addClass("cur")},rulesVersionEditBox:function(b,c){var a=$(b).text();crawlRules.fn.rulesVersionAddBox(c,a)},rulesVersionAddBox:function(b,a){easyDialog.open({container:{header:nc.i18n("res.rules.version.title"),content:'<label style="width:120px; text-align:right">'+nc.i18n("res.rules.version.label.name")+'</label> <input id="versionName" name="versionName" size="33" value="'+a+'" type="text"></input>',yesFn:function(){var c=document.getElementById("versionName").value;if(c==null||""==c){showInfo(nc.i18n("res.rules.version.label.name.null"));return false}jsonrpc.crawlRulesVerService.save(function(d,e,f){if(e){return}var g=d;if(!isNaN(g)){if(b==null){crawlRules.fn.addRulesVer(g,c)}else{$("#"+crawlRules.v.tableId).find("#rulesVersion").find("#"+g).attr("title",c);$("#"+crawlRules.v.tableId).find("#rulesVersion").find("#"+g).find("div").attr("title",c);$("#"+crawlRules.v.tableId).find("#rulesVersion").find("#"+g).find("div").text(c)}updateSelect(g,c,"crawlRulesVerId")}else{showInfo(nc.i18n("res.save.failure"))}},pageRules.v.webCrawlerId,pageRules.v.siteId,b,c);return true},noFn:true}})},defaultValueSel:function(a){$("#"+crawlRules.v.crawlRulesForm).find("#defaultValue").val(a)}}};var pageRules={v:{formId:"pageForm",siteJson:null,webCrawlerId:null,siteId:null},fn:{save:function(){var b=$("#"+pageRules.v.formId).find("#nextLinkExpress").val();var c=$("#"+pageRules.v.formId).find("#nextPageMaxTimes").val();var a=$("#"+pageRules.v.formId).find("#nextLinkMatchRules").val();showLoading($("#"+pageRules.v.formId));jsonrpc.crawlRulesService.savePage(function(d,e,f){if(e){return}var g=d;if(g){showInfo(nc.i18n("res.update.success"))}else{showInfo(nc.i18n("res.update.failure"))}if(crawlRules.v.rulesVerId==null||crawlRules.v.rulesVerId===""){crawlRules.fn.queryVer()}else{removeLoading($("#"+pageRules.v.formId))}},pageRules.v.webCrawlerId,pageRules.v.siteId,crawlRules.v.rulesVerId,b,c,a)},nextLink:function(){var d="";var f=$("#"+crawlRules.v.tableId).find(":checkbox[name=rules]");for(var b=0,a=f.length;b<a;b++){if(f[b].checked){if(d==""){d=f[b].value}else{d+=","+f[b].value}}}$("#"+crawlRules.v.tableId).find("#crawlResult").val(nc.i18n("res.fetch"));$("#tabsview > .ui-layout-content > div.ui-tabs-panel[aria-hidden='false']").animate({scrollTop:$("#tabsview > .ui-layout-content > div.ui-tabs-panel[aria-hidden='false']")[0].scrollHeight},1500);var e=$("#"+crawlRules.v.tableId).find("#crawlUrl").val();jsonrpc.crawlRulesService.nextLink(function(c,g,h){$("#"+crawlRules.v.tableId).find("#crawlResult").val(c)},pageRules.v.webCrawlerId,pageRules.v.siteId,crawlRules.v.rulesVerId,e,d)},nextTest:function(){$("#"+crawlRules.v.tableId).find("#crawlResult").val(nc.i18n("res.fetch"));$("#tabsview > .ui-layout-content > div.ui-tabs-panel[aria-hidden='false']").animate({scrollTop:$("#tabsview > .ui-layout-content > div.ui-tabs-panel[aria-hidden='false']")[0].scrollHeight},1500);var a=$("#"+crawlRules.v.tableId).find("#crawlUrl").val();jsonrpc.crawlRulesService.nextTest(function(b,c,d){$("#"+crawlRules.v.tableId).find("#crawlResult").val(b)},pageRules.v.webCrawlerId,pageRules.v.siteId,crawlRules.v.rulesVerId,a)}}};